name: Daily Schedule Notifier

on:
  schedule:
    - cron: '0 4 * * *'   # 07:30 MSK — утреннее
    - cron: '0 15 * * *'   # 19:00 MSK — вечернее
  workflow_dispatch:
    inputs:
      period:
        description: 'Период'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - evening

jobs:
  send-notification:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4   # ← обновил на актуальную версию

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'   # ← 3.9 уже устарел, лучше 3.11+

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install aiohttp requests   # ← добавил requests (скорее всего нужен)

      - name: Определение периода
        id: period
        run: |
          if [[ "${{ github.event_name }}" == "schedule" ]]; then
            HOUR=$(date -u +%H)
            if [[ "$HOUR" == "04" ]]; then
              echo "period=morning" >> $GITHUB_OUTPUT
            else
              echo "period=evening" >> $GITHUB_OUTPUT
            fi
          else
            echo "period=${{ inputs.period }}" >> $GITHUB_OUTPUT
          fi

      - name: Отправка уведомления
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}   # ← ЭТО САМОЕ ГЛАВНОЕ!
        run: |
          echo "Запуск notifier.py с периодом: ${{ steps.period.outputs.period }}"
          python notifier.py ${{ steps.period.outputs.period }}
